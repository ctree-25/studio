{
  "entities": {
    "PlayerProfile": {
      "title": "PlayerProfile",
      "type": "object",
      "description": "Represents a volleyball player's profile.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user this profile belongs to."
        },
        "name": {
          "type": "string"
        },
        "position": {
          "type": "string"
        },
        "height": {
          "type": "string"
        },
        "gradYear": {
          "type": "string"
        },
        "profilePictureUrl": {
          "type": "string",
          "format": "uri"
        },
        "targetLevel": {
          "type": "string",
          "enum": [
            "D1",
            "D2",
            "D3"
          ]
        },
        "preferredSchools": {
          "type": "string"
        },
        "highlightVideoUrl": {
          "type": "string",
          "format": "uri"
        },
        "submitted": {
          "type": "boolean"
        }
      },
      "required": [
        "userId",
        "name",
        "position",
        "height",
        "gradYear",
        "targetLevel",
        "preferredSchools",
        "highlightVideoUrl",
        "submitted"
      ]
    },
    "CoachProfile": {
      "title": "CoachProfile",
      "type": "object",
      "description": "Represents a volleyball coach's profile.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user this profile belongs to."
        },
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "experience": {
          "type": "string"
        },
        "levelOfCoaching": {
          "type": "string"
        },
        "affiliation": {
          "type": "string"
        },
        "phone": {
          "type": "string"
        },
        "placedPlayerLevels": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "profileLink": {
          "type": "string",
          "format": "uri"
        },
        "profilesPerWeek": {
          "type": "string"
        }
      },
      "required": [
        "userId",
        "firstName",
        "lastName",
        "email",
        "experience",
        "levelOfCoaching",
        "affiliation",
        "phone",
        "placedPlayerLevels",
        "profilesPerWeek"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application. This is for storing user details after they authenticate through Google Sign-In. Not for credentials.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "The Google ID of the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "role": {
          "type": "string",
          "description": "The user's role (e.g., player, coach)."
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "displayName",
        "role"
      ]
    },
    "CoachFeedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CoachFeedback",
      "type": "object",
      "description": "Represents feedback given by a coach to a player.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CoachFeedback entity."
        },
        "playerProfileId": {
          "type": "string",
          "description": "Reference to PlayerProfile. (Relationship: PlayerProfile 1:N CoachFeedback)"
        },
        "coachProfileId": {
          "type": "string",
          "description": "Reference to CoachProfile. (Relationship: CoachProfile 1:N CoachFeedback)"
        },
        "feedbackText": {
          "type": "string",
          "description": "The text of the feedback provided by the coach."
        },
        "dateGiven": {
          "type": "string",
          "description": "The date the feedback was given.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "playerProfileId",
        "coachProfileId",
        "feedbackText",
        "dateGiven"
      ]
    },
    "TargetSchool": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TargetSchool",
      "type": "object",
      "description": "Represents a school that a player is targeting.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TargetSchool entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the target school."
        },
        "level": {
          "type": "string",
          "description": "The level of play at the target school (e.g., D1, D2, D3)."
        },
        "location": {
          "type": "string",
          "description": "The location of the target school."
        },
        "playerProfileIds": {
          "type": "array",
          "description": "References to PlayerProfiles. (Relationship: PlayerProfile N:N TargetSchool)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "level",
        "location"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. This collection uses path-based ownership for managing user data. The 'userId' parameter corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/playerProfiles/{userId}",
        "definition": {
          "entityName": "PlayerProfile",
          "schema": {
            "$ref": "#/backend/entities/PlayerProfile"
          },
          "description": "Stores player profiles. The document ID is the user's UID."
        }
      },
      {
        "path": "/coachProfiles/{userId}",
        "definition": {
          "entityName": "CoachProfile",
          "schema": {
            "$ref": "#/backend/entities/CoachProfile"
          },
          "description": "Stores coach profiles. The document ID is the user's UID."
        }
      },
      {
        "path": "/playerProfiles/{playerProfileId}/coachFeedbacks/{coachFeedbackId}",
        "definition": {
          "entityName": "CoachFeedback",
          "schema": {
            "$ref": "#/backend/entities/CoachFeedback"
          },
          "description": "Stores coach feedback for a specific player. Requires denormalized 'coachProfileId' within each feedback document to ensure only the assigned coach can create feedback. Also contains 'playerProfileId' to ensure the feedback relates to the intended player.",
          "params": [
            {
              "name": "playerProfileId",
              "description": "The unique identifier for the player profile receiving feedback."
            },
            {
              "name": "coachFeedbackId",
              "description": "The unique identifier for the coach feedback document."
            }
          ]
        }
      },
      {
        "path": "/targetSchools/{targetSchoolId}",
        "definition": {
          "entityName": "TargetSchool",
          "schema": {
            "$ref": "#/backend/entities/TargetSchool"
          },
          "description": "Stores target schools.  This collection is publicly readable.",
          "params": [
            {
              "name": "targetSchoolId",
              "description": "The unique identifier for the target school."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure authorization independence, clarity, and scalability for the CourtConnect application. Player and Coach profiles are stored in top-level collections with the document ID matching the user's UID for direct, efficient lookups. This enforces a one-to-one relationship between a user and their primary profile. This structure avoids complex queries and simplifies security rules by leveraging path-based ownership directly.\n\n*   **Users:** Each user has a profile document under `/users/{userId}`.\n*   **Player Profiles:** Player profiles are stored in `/playerProfiles/{userId}`. This makes it easy for any authenticated user (like a coach) to read a player's profile while restricting write access to the owner.\n*   **Coach Profiles:** Coach profiles are stored in `/coachProfiles/{userId}` following the same pattern as player profiles.\n*   **Target Schools:** Target schools are stored in a top-level `/targetSchools/{targetSchoolId}` collection, which is publicly readable.\n*   **Coach Feedback:** Coach feedback is a subcollection under the player's profile: `/playerProfiles/{playerProfileId}/coachFeedbacks/{coachFeedbackId}`. This naturally associates feedback with the player while denormalizing the coach's user ID into the feedback document to manage write permissions.\n\nThis model is secure, scalable, and simplifies the client-side code needed to interact with Firestore."
  }
}
